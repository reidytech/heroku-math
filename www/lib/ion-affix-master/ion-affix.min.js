angular.module("ion-affix",["ionic"]).directive("ionAffix",["$ionicPosition","$compile",function(n,t){function i(n,t){return angular.element(ionic.DomUtil.getParentWithClass(n[0],t))}function e(n){return ionic.Utils.throttle(n)}function o(n){return ionic.requestAnimationFrame(n)}function r(t){return n.offset(t)}function a(t){return n.position(t)}function l(n,t){n.style[ionic.CSS.TRANSFORM]==t||(n.style[ionic.CSS.TRANSFORM]=t)}function f(n,t,i){var e=0==t?"translate3d(0px, 0px, 0px)":"translate3d(0px, -"+t+"px, 0px)";i?l(n,e):o(function(){l(n,e)})}return{restrict:"A",require:"^$ionicScroll",link:function(n,o,l,u){var c;l.affixWithinParentWithClass?(c=i(o,l.affixWithinParentWithClass))||(c=o.parent()):c=o.parent();var s=0,m=0,p=0,x=function(n){var t=a(c),i=r(o),e=t.top,l=t.height,f=i.height;s=n+e,m=s+l,p=m-f},v=e(x),h=null,d=function(){var i=o.clone().css({position:"absolute",top:0,left:0,right:0});return l.affixClass&&i.addClass(l.affixClass),i.removeAttr("ion-affix").removeAttr("data-ion-affix").removeAttr("x-ion-affix"),angular.element(u.element).append(i),t(i)(n),i},g=function(){h&&h.remove(),h=null};n.$on("$destroy",function(){g(),angular.element(u.element).off("scroll")}),angular.element(u.element).on("scroll",function(n){var t=(n.detail||n.originalEvent&&n.originalEvent.detail).scrollTop;if(0==t?x(t):v(t),t>=s&&t<=m){var i=!1;h||(h=d(),i=!0),t>p?f(h[0],Math.floor(t-p),i):f(h[0],0,i)}else g()})}}}]);